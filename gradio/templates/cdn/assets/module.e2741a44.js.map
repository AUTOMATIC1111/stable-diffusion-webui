{"version":3,"file":"module.e2741a44.js","sources":["../../../../ui/node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/factories/add-unique-number.js","../../../../ui/node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/factories/cache.js","../../../../ui/node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/factories/generate-unique-number.js","../../../../ui/node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/module.js","../../../../ui/node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/guards/message-port.js","../../../../ui/node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/helpers/port-map.js","../../../../ui/node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/helpers/extend-broker-implementation.js","../../../../ui/node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/module.js"],"sourcesContent":["export const createAddUniqueNumber = (generateUniqueNumber) => {\n    return (set) => {\n        const number = generateUniqueNumber(set);\n        set.add(number);\n        return number;\n    };\n};\n//# sourceMappingURL=add-unique-number.js.map","export const createCache = (lastNumberWeakMap) => {\n    return (collection, nextNumber) => {\n        lastNumberWeakMap.set(collection, nextNumber);\n        return nextNumber;\n    };\n};\n//# sourceMappingURL=cache.js.map","/*\n * The value of the constant Number.MAX_SAFE_INTEGER equals (2 ** 53 - 1) but it\n * is fairly new.\n */\nconst MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER === undefined ? 9007199254740991 : Number.MAX_SAFE_INTEGER;\nconst TWO_TO_THE_POWER_OF_TWENTY_NINE = 536870912;\nconst TWO_TO_THE_POWER_OF_THIRTY = TWO_TO_THE_POWER_OF_TWENTY_NINE * 2;\nexport const createGenerateUniqueNumber = (cache, lastNumberWeakMap) => {\n    return (collection) => {\n        const lastNumber = lastNumberWeakMap.get(collection);\n        /*\n         * Let's try the cheapest algorithm first. It might fail to produce a new\n         * number, but it is so cheap that it is okay to take the risk. Just\n         * increase the last number by one or reset it to 0 if we reached the upper\n         * bound of SMIs (which stands for small integers). When the last number is\n         * unknown it is assumed that the collection contains zero based consecutive\n         * numbers.\n         */\n        let nextNumber = lastNumber === undefined ? collection.size : lastNumber < TWO_TO_THE_POWER_OF_THIRTY ? lastNumber + 1 : 0;\n        if (!collection.has(nextNumber)) {\n            return cache(collection, nextNumber);\n        }\n        /*\n         * If there are less than half of 2 ** 30 numbers stored in the collection,\n         * the chance to generate a new random number in the range from 0 to 2 ** 30\n         * is at least 50%. It's benifitial to use only SMIs because they perform\n         * much better in any environment based on V8.\n         */\n        if (collection.size < TWO_TO_THE_POWER_OF_TWENTY_NINE) {\n            while (collection.has(nextNumber)) {\n                nextNumber = Math.floor(Math.random() * TWO_TO_THE_POWER_OF_THIRTY);\n            }\n            return cache(collection, nextNumber);\n        }\n        // Quickly check if there is a theoretical chance to generate a new number.\n        if (collection.size > MAX_SAFE_INTEGER) {\n            throw new Error('Congratulations, you created a collection of unique numbers which uses all available integers!');\n        }\n        // Otherwise use the full scale of safely usable integers.\n        while (collection.has(nextNumber)) {\n            nextNumber = Math.floor(Math.random() * MAX_SAFE_INTEGER);\n        }\n        return cache(collection, nextNumber);\n    };\n};\n//# sourceMappingURL=generate-unique-number.js.map","import { createAddUniqueNumber } from './factories/add-unique-number';\nimport { createCache } from './factories/cache';\nimport { createGenerateUniqueNumber } from './factories/generate-unique-number';\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './types/index';\nconst LAST_NUMBER_WEAK_MAP = new WeakMap();\nconst cache = createCache(LAST_NUMBER_WEAK_MAP);\nconst generateUniqueNumber = createGenerateUniqueNumber(cache, LAST_NUMBER_WEAK_MAP);\nconst addUniqueNumber = createAddUniqueNumber(generateUniqueNumber);\nexport { addUniqueNumber, generateUniqueNumber };\n//# sourceMappingURL=module.js.map","export const isMessagePort = (sender) => {\n    return typeof sender.start === 'function';\n};\n//# sourceMappingURL=message-port.js.map","export const PORT_MAP = new WeakMap();\n//# sourceMappingURL=port-map.js.map","import { PORT_MAP } from './port-map';\nexport const extendBrokerImplementation = (partialBrokerImplementation) => ({\n    ...partialBrokerImplementation,\n    connect: ({ call }) => {\n        return async () => {\n            const { port1, port2 } = new MessageChannel();\n            const portId = await call('connect', { port: port1 }, [port1]);\n            PORT_MAP.set(port2, portId);\n            return port2;\n        };\n    },\n    disconnect: ({ call }) => {\n        return async (port) => {\n            const portId = PORT_MAP.get(port);\n            if (portId === undefined) {\n                throw new Error('The given port is not connected.');\n            }\n            await call('disconnect', { portId });\n        };\n    },\n    isSupported: ({ call }) => {\n        return () => call('isSupported');\n    }\n});\n//# sourceMappingURL=extend-broker-implementation.js.map","import { generateUniqueNumber } from 'fast-unique-numbers';\nimport { isMessagePort } from './guards/message-port';\nimport { extendBrokerImplementation } from './helpers/extend-broker-implementation';\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './interfaces/index';\nexport * from './types/index';\nconst ONGOING_REQUESTS = new WeakMap();\nconst createOrGetOngoingRequests = (sender) => {\n    if (ONGOING_REQUESTS.has(sender)) {\n        // @todo TypeScript needs to be convinced that has() works as expected.\n        return ONGOING_REQUESTS.get(sender);\n    }\n    const ongoingRequests = new Map();\n    ONGOING_REQUESTS.set(sender, ongoingRequests);\n    return ongoingRequests;\n};\nexport const createBroker = (brokerImplementation) => {\n    const fullBrokerImplementation = extendBrokerImplementation(brokerImplementation);\n    return (sender) => {\n        const ongoingRequests = createOrGetOngoingRequests(sender);\n        sender.addEventListener('message', (({ data: message }) => {\n            const { id } = message;\n            if (id !== null && ongoingRequests.has(id)) {\n                const { reject, resolve } = ongoingRequests.get(id);\n                ongoingRequests.delete(id);\n                if (message.error === undefined) {\n                    resolve(message.result);\n                }\n                else {\n                    reject(new Error(message.error.message));\n                }\n            }\n        }));\n        if (isMessagePort(sender)) {\n            sender.start();\n        }\n        const call = (method, params = null, transferables = []) => {\n            return new Promise((resolve, reject) => {\n                const id = generateUniqueNumber(ongoingRequests);\n                ongoingRequests.set(id, { reject, resolve });\n                if (params === null) {\n                    sender.postMessage({ id, method }, transferables);\n                }\n                else {\n                    sender.postMessage({ id, method, params }, transferables);\n                }\n            });\n        };\n        const notify = (method, params, transferables = []) => {\n            sender.postMessage({ id: null, method, params }, transferables);\n        };\n        let functions = {};\n        for (const [key, handler] of Object.entries(fullBrokerImplementation)) {\n            functions = { ...functions, [key]: handler({ call, notify }) };\n        }\n        return { ...functions };\n    };\n};\n//# sourceMappingURL=module.js.map"],"names":[],"mappings":"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"}