{"version":3,"file":"Upload.233e3186.js","sources":["../../../../ui/packages/upload/src/Upload.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { createEventDispatcher } from \"svelte\";\n\timport type { FileData } from \"./types\";\n\timport { blobToBase64 } from \"./utils\";\n\n\texport let filetype: string | null = null;\n\texport let include_file_metadata = true;\n\texport let dragging = false;\n\texport let boundedheight: boolean = true;\n\texport let center: boolean = true;\n\texport let flex: boolean = true;\n\texport let file_count: string = \"single\";\n\texport let disable_click = false;\n\texport let parse_to_data_url = true;\n\n\tlet hidden_upload: HTMLInputElement;\n\n\tconst dispatch = createEventDispatcher();\n\n\tconst updateDragging = () => {\n\t\tdragging = !dragging;\n\t};\n\n\tconst openFileUpload = () => {\n\t\tif (disable_click) return;\n\t\thidden_upload.value = \"\";\n\t\thidden_upload.click();\n\t};\n\n\tconst loadFiles = async (files: FileList) => {\n\t\tlet _files: Array<File> = Array.from(files);\n\t\tif (!files.length || !window.FileReader) {\n\t\t\treturn;\n\t\t}\n\t\tif (file_count === \"single\") {\n\t\t\t_files = [files[0]];\n\t\t}\n\n\t\tif (include_file_metadata) {\n\t\t\tvar file_metadata: Array<{ name: string; size: number }> = _files.map(\n\t\t\t\t(f) => ({\n\t\t\t\t\tname: f.name,\n\t\t\t\t\tsize: f.size\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tvar load_file_data = [];\n\t\tvar file_data: Array<string> | Array<File> = [];\n\t\tif (parse_to_data_url) {\n\t\t\tfile_data = await Promise.all(_files.map((f) => blobToBase64(f)));\n\t\t} else {\n\t\t\tfile_data = _files;\n\t\t}\n\t\tif (include_file_metadata) {\n\t\t\tif (parse_to_data_url) {\n\t\t\t\tload_file_data = file_data.map((data, i) => ({\n\t\t\t\t\tdata,\n\t\t\t\t\t...file_metadata[i]\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tload_file_data = file_data.map((data, i) => ({\n\t\t\t\t\tdata: \"\",\n\t\t\t\t\tblob: data,\n\t\t\t\t\t...file_metadata[i]\n\t\t\t\t}));\n\t\t\t}\n\t\t} else {\n\t\t\tload_file_data = file_data;\n\t\t}\n\t\tdispatch(\n\t\t\t\"load\",\n\t\t\tfile_count === \"single\" ? load_file_data[0] : load_file_data\n\t\t);\n\t};\n\n\tconst loadFilesFromUpload = async (e: Event) => {\n\t\tconst target = e.target as HTMLInputElement;\n\n\t\tif (!target.files) return;\n\t\tawait loadFiles(target.files);\n\t};\n\n\tconst loadFilesFromDrop = async (e: DragEvent) => {\n\t\tdragging = false;\n\t\tif (!e.dataTransfer?.files) return;\n\t\tawait loadFiles(e.dataTransfer.files);\n\t};\n</script>\n\n<div\n\tclass:center\n\tclass:boundedheight\n\tclass:flex\n\ton:drag|preventDefault|stopPropagation\n\ton:dragstart|preventDefault|stopPropagation\n\ton:dragend|preventDefault|stopPropagation\n\ton:dragover|preventDefault|stopPropagation\n\ton:dragenter|preventDefault|stopPropagation\n\ton:dragleave|preventDefault|stopPropagation\n\ton:drop|preventDefault|stopPropagation\n\ton:click={openFileUpload}\n\ton:drop={loadFilesFromDrop}\n\ton:dragenter={updateDragging}\n\ton:dragleave={updateDragging}\n>\n\t<slot />\n\t<input\n\t\ttype=\"file\"\n\t\tbind:this={hidden_upload}\n\t\ton:change={loadFilesFromUpload}\n\t\taccept={filetype}\n\t\tmultiple={file_count === \"multiple\" || undefined}\n\t\twebkitdirectory={file_count === \"directory\" || undefined}\n\t\tmozdirectory={file_count === \"directory\" || undefined}\n\t/>\n</div>\n\n<style>\n\tdiv {\n\t\tcursor: pointer;\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\n\t.center {\n\t\ttext-align: center;\n\t}\n\t.flex {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\tinput {\n\t\tdisplay: none;\n\t}\n</style>\n"],"names":[],"mappings":"ybA8GU,mBACE,OAAe,YAAc,+BACtB,OAAe,aAAe,MAAS,uBAC1C,OAAe,aAAe,MAAS,oIAxBvD,+BAiBC,yCAGY,gNATF,iBACD,sBACK,sBACA,uHAOL,wBACE,OAAe,YAAc,2CACtB,OAAe,aAAe,qDACjC,OAAe,aAAe,2PA5GlC,WAA0B,SAC1B,wBAAwB,OACxB,WAAW,OACX,gBAAyB,OACzB,SAAkB,OAClB,OAAgB,OAChB,aAAqB,aACrB,gBAAgB,OAChB,oBAAoB,MAE3B,OAEE,GAAW,KAEX,YACL,GAAY,CAAQ,GAGf,OACD,QACJ,EAAc,MAAQ,MACtB,EAAc,UAGT,OAAmB,QACpB,GAAsB,MAAM,KAAK,CAAK,QACrC,EAAM,SAAW,OAAO,gBAGzB,IAAe,UAClB,IAAU,EAAM,KAGb,KACC,GAAuD,EAAO,IAChE,KACA,KAAM,EAAE,KACR,KAAM,EAAE,WAIP,MACA,KACA,EACH,OAAkB,SAAQ,IAAI,EAAO,IAAK,GAAM,GAAa,CAAC,IAE9D,EAAY,EAET,EACC,EACH,EAAiB,EAAU,KAAK,EAAM,MACrC,UACG,EAAc,MAGlB,EAAiB,EAAU,KAAK,EAAM,MACrC,KAAM,GACN,KAAM,KACH,EAAc,MAInB,EAAiB,EAElB,EACC,OACA,IAAe,SAAW,EAAe,GAAK,CAAc,IAIxD,OAA6B,UAC5B,GAAS,EAAE,QAEZ,EAAO,YACN,GAAU,EAAO,KAAK,GAGvB,OAA2B,UAChC,EAAW,EAAK,EACX,EAAE,cAAc,YACf,GAAU,EAAE,aAAa,KAAK,sQAuBzB"}